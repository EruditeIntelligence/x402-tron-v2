{"version":3,"sources":["../../../src/types.ts","../../../src/exact/facilitator/scheme.ts","../../../src/constants.ts","../../../src/exact/facilitator/register.ts"],"sourcesContent":["/**\n * @module @erudite-intelligence/x402-tron-v2 - Types\n * @description Tron-specific payload and signer types for x402 V2\n * @author Erudite Intelligence LLC (Vector)\n * @created 2026-02-13\n * @purpose Define Tron payment payload structures and type guards\n */\n\n// =============================================================================\n// Payment Payload Types\n// =============================================================================\n\n/**\n * Tron exact payment payload for x402 V2.\n *\n * Unlike EVM (which uses EIP-3009/Permit2 signed authorizations) or SVM\n * (which uses partially-signed transactions), Tron uses a simpler model:\n * the client constructs and signs a TRC-20 transfer transaction, and the\n * facilitator verifies the transaction structure before broadcasting it.\n *\n * Flow:\n * 1. Client builds a TRC-20 transfer tx (from → payTo, amount)\n * 2. Client signs the tx with their private key\n * 3. Client sends the signed tx hex as the payload\n * 4. Facilitator decodes, verifies amounts/recipients, then broadcasts\n */\nexport interface ExactTronPayloadV2 {\n  /**\n   * The signed transaction as a JSON-serialized string.\n   * Produced by JSON.stringify(tronWeb.trx.sign(tx)).\n   * Contains: raw_data, raw_data_hex, txID, signature[], visible.\n   */\n  signedTransaction: string;\n\n  /**\n   * The sender's Tron address (base58 format).\n   * Used for verification that the signer matches the transfer `from`.\n   */\n  from: string;\n\n  /**\n   * Optional: transaction ID (txID) for pre-verification.\n   * TronWeb generates this deterministically from the transaction data.\n   */\n  txID?: string;\n}\n\n/**\n * Alternative payload: TRC-20 approve + facilitator-executed transfer.\n * The client approves the facilitator to spend their tokens, and the\n * facilitator executes the transferFrom on their behalf.\n *\n * This is more gas-efficient for the client (approve costs less energy\n * than transfer) and gives the facilitator control over execution timing.\n */\nexport interface ExactTronApprovePayloadV2 {\n  /**\n   * The approval method used\n   */\n  method: \"approve\";\n\n  /**\n   * The signed approval transaction in hex format.\n   * Approves the facilitator address to spend the exact payment amount.\n   */\n  signedApproval: string;\n\n  /**\n   * The sender's Tron address (base58 format).\n   */\n  from: string;\n\n  /**\n   * The nonce or unique identifier to prevent replay\n   */\n  nonce: string;\n}\n\n/**\n * Union type for all supported Tron exact payloads\n */\nexport type ExactTronPayload = ExactTronPayloadV2 | ExactTronApprovePayloadV2;\n\n// =============================================================================\n// Type Guards\n// =============================================================================\n\n/**\n * Check if a payload is a direct signed transaction payload\n */\nexport function isSignedTransactionPayload(\n  payload: unknown,\n): payload is ExactTronPayloadV2 {\n  if (typeof payload !== \"object\" || payload === null) return false;\n  const p = payload as Record<string, unknown>;\n  return (\n    typeof p.signedTransaction === \"string\" &&\n    typeof p.from === \"string\" &&\n    !(\"method\" in p)\n  );\n}\n\n/**\n * Check if a payload is an approve-based payload\n */\nexport function isApprovePayload(\n  payload: unknown,\n): payload is ExactTronApprovePayloadV2 {\n  if (typeof payload !== \"object\" || payload === null) return false;\n  const p = payload as Record<string, unknown>;\n  return p.method === \"approve\" && typeof p.signedApproval === \"string\";\n}\n\n// =============================================================================\n// Configuration Types\n// =============================================================================\n\n/**\n * Configuration for the Tron facilitator.\n *\n * NOTE: useWrapperContract and feeDelegation are RESERVED for future implementation.\n * They are NOT currently active. Setting them has no effect on payment routing.\n * When implemented, useWrapperContract will route payments through the EruditePay\n * wrapper contract for automated on-chain fee deduction. feeDelegation will have\n * the facilitator cover energy costs for senders.\n */\nexport interface TronFacilitatorConfig {\n  /**\n   * RESERVED / NOT YET IMPLEMENTED.\n   * When implemented: Use EruditePay wrapper contract for automated fee collection.\n   * Currently has NO effect — payments always go direct from client to payTo.\n   * @default false\n   */\n  useWrapperContract?: boolean;\n\n  /**\n   * Optional: Maximum energy fee (in SUN) the facilitator will pay.\n   * Transactions exceeding this limit will be rejected during verification.\n   * @default 100_000_000 (100 TRX)\n   */\n  maxEnergyFeeSun?: number;\n\n  /**\n   * RESERVED / NOT YET IMPLEMENTED.\n   * When implemented: Facilitator pays energy costs on behalf of sender.\n   * Currently has NO effect — sender must have sufficient energy/TRX.\n   * @default false\n   */\n  feeDelegation?: boolean;\n}\n\n/**\n * Result of a Tron transaction broadcast\n */\nexport interface TronBroadcastResult {\n  result: boolean;\n  txid: string;\n  code?: string;\n  message?: string;\n}\n","/**\n * @module @erudite-intelligence/x402-tron-v2 - Facilitator Scheme\n * @description x402 V2 facilitator implementation for the Tron exact payment scheme.\n *   Verifies and settles TRC-20 payment transactions on the Tron network.\n * @author Erudite Intelligence LLC (Vector)\n * @created 2026-02-13\n * @purpose First x402 V2 facilitator for Tron - verify signed TRC-20 transfers and broadcast them\n *\n * CHANGELOG:\n * - 2026-02-13: Initial implementation. Supports signed TRC-20 transfer verification and settlement.\n */\n\nimport type {\n  PaymentPayload,\n  PaymentRequirements,\n  SchemeNetworkFacilitator,\n  SettleResponse,\n  VerifyResponse,\n} from \"@x402/core/types\";\nimport type { FacilitatorTronSigner } from \"../../signer\";\nimport type { ExactTronPayloadV2, TronFacilitatorConfig } from \"../../types\";\nimport { isSignedTransactionPayload } from \"../../types\";\n\n/**\n * Tron facilitator implementation for the Exact payment scheme.\n *\n * Verification flow:\n * 1. Decode the signed transaction\n * 2. Verify it's a TRC-20 transfer to the correct recipient\n * 3. Verify the transfer amount meets requirements\n * 4. Verify the token contract matches the required asset\n * 5. Verify the sender has sufficient token balance\n * 6. Verify the transaction hasn't expired\n *\n * Settlement flow:\n * 1. Re-verify the payment (verify() is called internally)\n * 2. Broadcast the signed transaction to the Tron network\n * 3. Wait for confirmation\n * 4. Return the transaction hash\n */\nexport class ExactTronScheme implements SchemeNetworkFacilitator {\n  readonly scheme = \"exact\";\n  readonly caipFamily = \"tron:*\";\n  private readonly config: Required<TronFacilitatorConfig>;\n\n  /**\n   * Creates a new ExactTronScheme facilitator instance.\n   *\n   * @param signer - The Tron signer for facilitator operations\n   * @param config - Optional configuration for the facilitator\n   */\n  constructor(\n    private readonly signer: FacilitatorTronSigner,\n    config?: TronFacilitatorConfig,\n  ) {\n    this.config = {\n      useWrapperContract: config?.useWrapperContract ?? false,\n      maxEnergyFeeSun: config?.maxEnergyFeeSun ?? 100_000_000, // 100 TRX — reserved for future use\n      feeDelegation: config?.feeDelegation ?? false,\n    };\n  }\n\n  /**\n   * Get mechanism-specific extra data for the supported kinds endpoint.\n   *\n   * Currently returns minimal metadata. energyDelegation and wrapperContract\n   * will be exposed here once those features are implemented.\n   *\n   * @param _network - The network identifier (currently unused)\n   * @returns Extra data for clients, or undefined if no extra data\n   */\n  getExtra(_network: string): Record<string, unknown> | undefined {\n    // Only advertise features that are actually implemented.\n    // useWrapperContract and feeDelegation are reserved for future use.\n    // When implemented, they will be exposed here.\n    return undefined;\n  }\n\n  /**\n   * Get signer addresses used by this facilitator.\n   * @param _network - The network identifier (unused - Tron addresses are network-agnostic)\n   * @returns Array of facilitator Tron addresses (base58)\n   */\n  getSigners(_network: string): string[] {\n    return [...this.signer.getAddresses()];\n  }\n\n  /**\n   * Verifies a Tron payment payload.\n   *\n   * Security checks performed:\n   * - Scheme and network validation\n   * - Transaction format validation (must be a TRC-20 transfer)\n   * - Token contract matches required asset\n   * - Recipient matches payTo address\n   * - Amount meets or exceeds required amount\n   * - Sender has sufficient token balance\n   * - Transaction has not expired\n   * - Facilitator address is NOT the sender (prevent self-transfers)\n   *\n   * @param payload - The payment payload to verify\n   * @param requirements - The payment requirements\n   * @returns Promise resolving to verification response\n   */\n  async verify(\n    payload: PaymentPayload,\n    requirements: PaymentRequirements,\n  ): Promise<VerifyResponse> {\n    // Step 1: Validate scheme and network\n    if (payload.accepted.scheme !== \"exact\" || requirements.scheme !== \"exact\") {\n      return {\n        isValid: false,\n        invalidReason: \"unsupported_scheme\",\n        payer: \"\",\n      };\n    }\n\n    if (payload.accepted.network !== requirements.network) {\n      return {\n        isValid: false,\n        invalidReason: \"network_mismatch\",\n        payer: \"\",\n      };\n    }\n\n    // Step 2: Validate payload type\n    const rawPayload = payload.payload;\n    if (!isSignedTransactionPayload(rawPayload)) {\n      return {\n        isValid: false,\n        invalidReason: \"invalid_tron_payload_type\",\n        invalidMessage: \"Expected signed transaction payload with 'signedTransaction' and 'from' fields\",\n        payer: \"\",\n      };\n    }\n\n    const tronPayload = rawPayload as unknown as ExactTronPayloadV2;\n\n    // Step 3: Decode and validate the transaction\n    let decoded;\n    try {\n      decoded = await this.signer.decodeTransaction(\n        tronPayload.signedTransaction,\n        requirements.network,\n      );\n    } catch (error) {\n      return {\n        isValid: false,\n        invalidReason: \"invalid_tron_payload_decode_failed\",\n        invalidMessage: error instanceof Error ? error.message : \"Failed to decode transaction\",\n        payer: tronPayload.from,\n      };\n    }\n\n    // Step 4: Verify it's a TRC-20 transfer (function selector a9059cbb)\n    if (decoded.contractType !== \"TriggerSmartContract\") {\n      return {\n        isValid: false,\n        invalidReason: \"invalid_tron_payload_not_smart_contract\",\n        invalidMessage: `Expected TriggerSmartContract, got ${decoded.contractType}`,\n        payer: tronPayload.from,\n      };\n    }\n\n    if (decoded.functionSelector !== \"a9059cbb\") {\n      return {\n        isValid: false,\n        invalidReason: \"invalid_tron_payload_not_transfer\",\n        invalidMessage: `Expected transfer(address,uint256) selector a9059cbb, got ${decoded.functionSelector}`,\n        payer: tronPayload.from,\n      };\n    }\n\n    // Step 5: Verify the token contract matches the required asset\n    if (decoded.contractAddress !== requirements.asset) {\n      return {\n        isValid: false,\n        invalidReason: \"invalid_tron_payload_asset_mismatch\",\n        invalidMessage: `Expected asset ${requirements.asset}, transaction targets ${decoded.contractAddress}`,\n        payer: tronPayload.from,\n      };\n    }\n\n    // Step 6: Verify the recipient matches payTo\n    if (decoded.parameters.to !== requirements.payTo) {\n      return {\n        isValid: false,\n        invalidReason: \"invalid_tron_payload_recipient_mismatch\",\n        invalidMessage: `Expected recipient ${requirements.payTo}, transaction sends to ${decoded.parameters.to}`,\n        payer: tronPayload.from,\n      };\n    }\n\n    // Step 7: Verify the amount meets requirements\n    const txAmount = BigInt(decoded.parameters.amount || \"0\");\n    const requiredAmount = BigInt(requirements.amount);\n\n    if (txAmount < requiredAmount) {\n      return {\n        isValid: false,\n        invalidReason: \"invalid_tron_payload_amount_insufficient\",\n        invalidMessage: `Required ${requiredAmount.toString()}, transaction sends ${txAmount.toString()}`,\n        payer: tronPayload.from,\n      };\n    }\n\n    // Step 8: Verify the sender matches the claimed 'from' address\n    if (decoded.ownerAddress !== tronPayload.from) {\n      return {\n        isValid: false,\n        invalidReason: \"invalid_tron_payload_sender_mismatch\",\n        invalidMessage: \"Transaction owner does not match claimed sender\",\n        payer: tronPayload.from,\n      };\n    }\n\n    // Step 9: SECURITY - Verify facilitator is NOT the sender (prevent self-transfers)\n    const facilitatorAddresses = this.signer.getAddresses();\n    if (facilitatorAddresses.includes(decoded.ownerAddress)) {\n      return {\n        isValid: false,\n        invalidReason: \"invalid_tron_payload_facilitator_is_sender\",\n        invalidMessage: \"Facilitator address cannot be the payment sender\",\n        payer: tronPayload.from,\n      };\n    }\n\n    // Step 10: Verify transaction has not expired\n    const now = Date.now();\n    if (decoded.expiration && decoded.expiration < now) {\n      return {\n        isValid: false,\n        invalidReason: \"invalid_tron_payload_expired\",\n        invalidMessage: `Transaction expired at ${new Date(decoded.expiration).toISOString()}`,\n        payer: tronPayload.from,\n      };\n    }\n\n    // Step 11: Verify sender has sufficient token balance\n    try {\n      const balance = await this.signer.getTokenBalance(\n        requirements.asset,\n        decoded.ownerAddress,\n        requirements.network,\n      );\n      const balanceBigInt = BigInt(balance);\n\n      if (balanceBigInt < requiredAmount) {\n        return {\n          isValid: false,\n          invalidReason: \"invalid_tron_payload_insufficient_balance\",\n          invalidMessage: `Sender balance ${balance} < required ${requirements.amount}`,\n          payer: tronPayload.from,\n        };\n      }\n    } catch (error) {\n      return {\n        isValid: false,\n        invalidReason: \"invalid_tron_payload_balance_check_failed\",\n        invalidMessage: error instanceof Error ? error.message : \"Balance check failed\",\n        payer: tronPayload.from,\n      };\n    }\n\n    // Step 12: Estimate energy cost and reject if too expensive\n    // Protects the facilitator from broadcasting extremely expensive txs\n    try {\n      const estimatedEnergy = await this.signer.estimateEnergy(\n        requirements.asset,\n        decoded.ownerAddress,\n        decoded.parameters.to || requirements.payTo,\n        requirements.amount,\n        requirements.network,\n      );\n\n      // Convert energy to SUN cost (energy price varies, use conservative 420 SUN/energy)\n      const estimatedFeeSun = estimatedEnergy * 420;\n      if (estimatedFeeSun > this.config.maxEnergyFeeSun) {\n        return {\n          isValid: false,\n          invalidReason: \"invalid_tron_payload_energy_too_expensive\",\n          invalidMessage: `Estimated energy cost ${estimatedFeeSun} SUN exceeds max ${this.config.maxEnergyFeeSun} SUN`,\n          payer: tronPayload.from,\n        };\n      }\n    } catch {\n      // Energy estimation is best-effort — don't reject if the RPC fails.\n      // The transaction may still succeed; confirmTransaction will catch failures.\n    }\n\n    // All checks passed\n    return {\n      isValid: true,\n      invalidReason: undefined,\n      payer: tronPayload.from,\n    };\n  }\n\n  /**\n   * Settles a payment by broadcasting the signed transaction to the Tron network.\n   *\n   * @param payload - The payment payload to settle\n   * @param requirements - The payment requirements\n   * @returns Promise resolving to settlement response with transaction hash\n   */\n  async settle(\n    payload: PaymentPayload,\n    requirements: PaymentRequirements,\n  ): Promise<SettleResponse> {\n    // First verify the payment\n    const verification = await this.verify(payload, requirements);\n    if (!verification.isValid) {\n      return {\n        success: false,\n        network: payload.accepted.network,\n        transaction: \"\",\n        errorReason: verification.invalidReason ?? \"verification_failed\",\n        errorMessage: verification.invalidMessage,\n        payer: verification.payer || \"\",\n      };\n    }\n\n    const tronPayload = payload.payload as unknown as ExactTronPayloadV2;\n\n    try {\n      // Second-layer verification: re-decode (which re-verifies signature)\n      // before broadcasting. Belt-and-suspenders against verify→settle race.\n      await this.signer.decodeTransaction(\n        tronPayload.signedTransaction,\n        requirements.network,\n      );\n\n      // Broadcast the signed transaction\n      // NOTE ON REPLAY PROTECTION: Tron nodes reject duplicate transactions\n      // (DUP_TRANSACTION_ERROR). An attacker attempting to reuse a previously\n      // settled transaction will fail at broadcast. Additionally, Tron\n      // transactions contain ref_block_bytes and ref_block_hash which bind\n      // them to a specific block range (~60 seconds), providing natural\n      // expiration. Combined with our expiration check in verify(), replay\n      // attacks are mitigated at the network layer.\n      //\n      // For additional safety, the x402 facilitator server (x402Facilitator\n      // class) should maintain a settled txID set to reject duplicates at\n      // the application layer before hitting the network.\n      const txID = await this.signer.broadcastTransaction(\n        tronPayload.signedTransaction,\n        requirements.network,\n      );\n\n      // Wait for confirmation\n      await this.signer.confirmTransaction(txID, requirements.network);\n\n      return {\n        success: true,\n        transaction: txID,\n        network: payload.accepted.network,\n        payer: verification.payer,\n      };\n    } catch (error) {\n      console.error(\"[x402-tron] Settlement failed:\", error);\n      return {\n        success: false,\n        errorReason: \"transaction_broadcast_failed\",\n        errorMessage: error instanceof Error ? error.message : \"Unknown broadcast error\",\n        transaction: \"\",\n        network: payload.accepted.network,\n        payer: verification.payer || \"\",\n      };\n    }\n  }\n}\n","/**\n * @module @erudite-intelligence/x402-tron-v2 - Constants\n * @description Tron network constants for x402 V2 plugin\n * @author Erudite Intelligence LLC (Vector)\n * @created 2026-02-13\n * @purpose Define CAIP-2 identifiers, asset addresses, and network configuration for Tron\n */\n\n// =============================================================================\n// CAIP-2 Network Identifiers\n// Format: tron:<genesis_block_hash_prefix>\n// Reference: https://docs.offblocks.xyz/developer-guides/api-integration/blockchain-identifiers\n// =============================================================================\n\n/** Tron Mainnet CAIP-2 identifier */\nexport const TRON_MAINNET = \"tron:27Lqcw\" as const;\n\n/** Tron Shasta Testnet CAIP-2 identifier */\nexport const TRON_SHASTA = \"tron:4oPwXB\" as const;\n\n/** Tron Nile Testnet CAIP-2 identifier */\nexport const TRON_NILE = \"tron:6FhfKq\" as const;\n\n/** CAIP-2 family pattern for Tron networks */\nexport const TRON_CAIP_FAMILY = \"tron:*\" as const;\n\n/** All supported Tron networks for V2 registration */\nexport const TRON_NETWORKS = [TRON_MAINNET, TRON_SHASTA, TRON_NILE] as const;\n\n/** All supported Tron networks for V1 backwards compatibility */\nexport const TRON_V1_NETWORKS = [TRON_MAINNET] as const;\n\n// =============================================================================\n// RPC Endpoints\n// =============================================================================\n\n/** Default RPC endpoints per CAIP-2 network identifier */\nexport const TRON_RPC_URLS: Record<string, string> = {\n  [TRON_MAINNET]: \"https://api.trongrid.io\",\n  [TRON_SHASTA]: \"https://api.shasta.trongrid.io\",\n  [TRON_NILE]: \"https://nile.trongrid.io\",\n};\n\n// =============================================================================\n// Token Addresses (Base58)\n// =============================================================================\n\n/** USDT TRC-20 contract addresses by CAIP-2 network */\nexport const USDT_ADDRESSES: Record<string, string> = {\n  [TRON_MAINNET]: \"TR7NHqjeKQxGTCi8q8ZY4pL8otSzgjLj6t\",\n  [TRON_SHASTA]: \"TG3XXyExBkPp9nzdajDZsozEu4BkaSJozs\", // Shasta USDT\n  [TRON_NILE]: \"TXLAQ63Xg1NAzckPwKHvzw7CSEmLMEqcdj\",   // Nile USDT\n};\n\n/** USDC TRC-20 contract addresses by CAIP-2 network */\nexport const USDC_ADDRESSES: Record<string, string> = {\n  [TRON_MAINNET]: \"TEkxiTehnzSmSe2XqrBj4w32RUN966rdz8\",\n};\n\n/** USDT decimals (6) - same across all TRC-20 USDT deployments */\nexport const USDT_DECIMALS = 6;\n\n/** USDC decimals (6) */\nexport const USDC_DECIMALS = 6;\n\n// =============================================================================\n// EruditePay Wrapper Contract\n// The hands-free x402 wrapper contract deployed on Tron mainnet.\n// Collects 0.25% facilitator fee automatically on-chain.\n// =============================================================================\n\n/** EruditePay wrapper contract address on Tron mainnet */\nexport const ERUDITEPAY_WRAPPER_CONTRACT = \"THGkLBrLY1G5VovZjjK1jP9upyxRdMNL3b\";\n\n/** EruditePay facilitator fee: 0.25% (25 basis points) */\nexport const ERUDITEPAY_FEE_BPS = 25;\n\n// =============================================================================\n// TRC-20 ABI (minimal for transfer operations)\n// =============================================================================\n\n/** Minimal TRC-20 ABI for transfer and balance operations */\nexport const TRC20_ABI = [\n  {\n    constant: false,\n    inputs: [\n      { name: \"_to\", type: \"address\" },\n      { name: \"_value\", type: \"uint256\" },\n    ],\n    name: \"transfer\",\n    outputs: [{ name: \"\", type: \"bool\" }],\n    type: \"Function\",\n  },\n  {\n    constant: true,\n    inputs: [{ name: \"_owner\", type: \"address\" }],\n    name: \"balanceOf\",\n    outputs: [{ name: \"balance\", type: \"uint256\" }],\n    type: \"Function\",\n  },\n  {\n    constant: true,\n    inputs: [\n      { name: \"_owner\", type: \"address\" },\n      { name: \"_spender\", type: \"address\" },\n    ],\n    name: \"allowance\",\n    outputs: [{ name: \"remaining\", type: \"uint256\" }],\n    type: \"Function\",\n  },\n  {\n    constant: false,\n    inputs: [\n      { name: \"_spender\", type: \"address\" },\n      { name: \"_value\", type: \"uint256\" },\n    ],\n    name: \"approve\",\n    outputs: [{ name: \"\", type: \"bool\" }],\n    type: \"Function\",\n  },\n  {\n    constant: true,\n    inputs: [],\n    name: \"decimals\",\n    outputs: [{ name: \"\", type: \"uint8\" }],\n    type: \"Function\",\n  },\n] as const;\n\n// =============================================================================\n// Energy/Bandwidth Defaults\n// =============================================================================\n\n/**\n * Estimated energy cost for a TRC-20 transfer.\n * Used for pre-flight checks. Actual cost may vary.\n */\nexport const ESTIMATED_TRC20_TRANSFER_ENERGY = 65_000;\n\n/**\n * Estimated bandwidth cost for a TRC-20 transfer (in bytes).\n * Used for pre-flight checks.\n */\nexport const ESTIMATED_TRC20_TRANSFER_BANDWIDTH = 350;\n\n/**\n * Maximum acceptable energy fee for a facilitator-paid transaction (in SUN).\n * 100 TRX = 100_000_000 SUN. Prevents runaway costs.\n */\nexport const MAX_ENERGY_FEE_SUN = 100_000_000;\n","/**\n * @module @erudite-intelligence/x402-tron-v2 - Facilitator Registration\n * @description Registration helper to add Tron support to any x402 V2 facilitator\n * @author Erudite Intelligence LLC (Vector)\n * @created 2026-02-13\n * @purpose One-line registration of Tron exact scheme into x402Facilitator\n *\n * CHANGELOG:\n * - 2026-02-13: Initial implementation. Mirrors registerExactEvmScheme/registerExactSvmScheme patterns.\n */\n\nimport { x402Facilitator } from \"@x402/core/facilitator\";\nimport type { Network } from \"@x402/core/types\";\nimport type { FacilitatorTronSigner } from \"../../signer\";\nimport type { TronFacilitatorConfig } from \"../../types\";\nimport { ExactTronScheme } from \"./scheme\";\nimport { TRON_NETWORKS } from \"../../constants\";\n\n/**\n * Configuration options for registering Tron schemes to an x402Facilitator\n */\nexport interface TronFacilitatorRegistrationConfig {\n  /**\n   * The Tron signer for facilitator operations (verify and settle)\n   */\n  signer: FacilitatorTronSigner;\n\n  /**\n   * Networks to register (single network or array of networks).\n   * Defaults to all Tron networks (mainnet, Shasta, Nile).\n   *\n   * @example\n   * // Single network\n   * networks: \"tron:27Lqcw\"\n   *\n   * @example\n   * // Multiple networks\n   * networks: [\"tron:27Lqcw\", \"tron:4oPwXB\"]\n   *\n   * @default TRON_NETWORKS (all supported Tron networks)\n   */\n  networks?: Network | Network[];\n\n  /**\n   * Optional scheme-level configuration\n   */\n  config?: TronFacilitatorConfig;\n}\n\n/**\n * Registers Tron exact payment schemes to an x402Facilitator instance.\n *\n * This is the primary integration point for adding Tron support to any\n * x402 V2 facilitator. Call this alongside registerExactEvmScheme and\n * registerExactSvmScheme to build a multi-chain facilitator.\n *\n * @param facilitator - The x402Facilitator instance to register schemes to\n * @param config - Configuration for Tron facilitator registration\n * @returns The facilitator instance for chaining\n *\n * @example\n * ```typescript\n * import { x402Facilitator } from \"@x402/core/facilitator\";\n * import { registerExactEvmScheme } from \"@x402/evm/exact/facilitator/register\";\n * import { registerExactTronScheme } from \"@erudite-intelligence/x402-tron-v2/exact/facilitator/register\";\n * import { toFacilitatorTronSigner } from \"@erudite-intelligence/x402-tron-v2\";\n * import TronWeb from \"tronweb\";\n *\n * const facilitator = new x402Facilitator();\n *\n * // Register EVM chains (Base, Ethereum, etc.)\n * registerExactEvmScheme(facilitator, { signer: evmSigner, networks: \"eip155:8453\" });\n *\n * // Register Tron (USDT TRC-20)\n * const tronWeb = new TronWeb({ fullHost: \"https://api.trongrid.io\", privateKey: \"...\" });\n * const tronSigner = toFacilitatorTronSigner(tronWeb);\n * registerExactTronScheme(facilitator, { signer: tronSigner });\n *\n * // Facilitator now handles both Base USDC and Tron USDT!\n * ```\n */\nexport function registerExactTronScheme(\n  facilitator: x402Facilitator,\n  config: TronFacilitatorRegistrationConfig,\n): x402Facilitator {\n  const networks = config.networks\n    ? (Array.isArray(config.networks) ? config.networks : [config.networks])\n    : [...TRON_NETWORKS] as Network[];\n\n  // Register V2 scheme with specified networks\n  facilitator.register(\n    networks as Network[],\n    new ExactTronScheme(config.signer, config.config),\n  );\n\n  // Note: V1 backwards compatibility is not registered for Tron because\n  // Tron was never part of the x402 V1 spec. This is a V2-only chain.\n  // If V1 support is needed in the future, it can be added here.\n\n  return facilitator;\n}\n"],"mappings":"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","names":[]}