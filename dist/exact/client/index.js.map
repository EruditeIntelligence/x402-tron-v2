{"version":3,"sources":["../../../src/exact/client/index.ts","../../../src/exact/client/scheme.ts","../../../src/constants.ts","../../../src/exact/client/register.ts"],"sourcesContent":["export { ExactTronScheme } from \"./scheme\";\nexport { registerExactTronClientScheme } from \"./register\";\nexport type { TronClientConfig } from \"./register\";\n","/**\n * @module @erudite-intelligence/x402-tron-v2 - Client Scheme\n * @description x402 V2 client implementation for creating Tron payment payloads.\n *   Builds and signs TRC-20 transfer transactions for x402 payments.\n * @author Erudite Intelligence LLC (Vector)\n * @created 2026-02-13\n * @purpose Enable x402 clients (AI agents, wallets) to create Tron payment payloads\n *\n * CHANGELOG:\n * - 2026-02-13: Initial implementation. Signed TRC-20 transfer payload creation.\n */\n\nimport type {\n  PaymentRequirements,\n  SchemeNetworkClient,\n  PaymentPayloadResult,\n} from \"@x402/core/types\";\nimport type { ClientTronSigner } from \"../../signer\";\n\n/**\n * Tron client implementation for the Exact payment scheme.\n *\n * Creates payment payloads by:\n * 1. Building a TRC-20 transfer transaction (to: payTo, amount: required amount)\n * 2. Signing it with the client's private key\n * 3. Returning the signed transaction as the payload\n *\n * The facilitator will then verify and broadcast this transaction.\n */\nexport class ExactTronScheme implements SchemeNetworkClient {\n  readonly scheme = \"exact\";\n\n  /**\n   * Creates a new ExactTronScheme client instance.\n   *\n   * @param signer - The Tron signer for client operations\n   */\n  constructor(private readonly signer: ClientTronSigner) {}\n\n  /**\n   * Creates a payment payload for the Exact scheme on Tron.\n   *\n   * Builds a TRC-20 transfer transaction targeting the merchant's (payTo) address\n   * for the required amount, signs it, and packages it as an x402 payload.\n   *\n   * @param x402Version - The x402 protocol version\n   * @param paymentRequirements - The payment requirements from the resource server\n   * @returns Promise resolving to a payment payload result\n   *\n   * @example\n   * ```typescript\n   * const client = new ExactTronScheme(signer);\n   * const payload = await client.createPaymentPayload(2, {\n   *   scheme: \"exact\",\n   *   network: \"tron:27Lqcw\",\n   *   asset: \"TR7NHqjeKQxGTCi8q8ZY4pL8otSzgjLj6t\", // USDT\n   *   amount: \"1000000\", // 1 USDT\n   *   payTo: \"TRecipientAddress...\",\n   *   maxTimeoutSeconds: 300,\n   *   extra: {},\n   * });\n   * ```\n   */\n  async createPaymentPayload(\n    x402Version: number,\n    paymentRequirements: PaymentRequirements,\n  ): Promise<PaymentPayloadResult> {\n    // Build the TRC-20 transfer transaction\n    const unsignedTx = await this.signer.buildTrc20Transfer(\n      paymentRequirements.asset,    // Token contract (e.g., USDT TRC-20)\n      paymentRequirements.payTo,    // Merchant address\n      paymentRequirements.amount,   // Amount in smallest unit\n    );\n\n    // Sign the transaction\n    const signedTx = await this.signer.signTransaction(unsignedTx);\n\n    // Package as x402 payload\n    return {\n      x402Version,\n      payload: {\n        signedTransaction: JSON.stringify(signedTx),\n        from: this.signer.address,\n        txID: (signedTx as Record<string, unknown>).txID as string | undefined,\n      },\n    };\n  }\n}\n","/**\n * @module @erudite-intelligence/x402-tron-v2 - Constants\n * @description Tron network constants for x402 V2 plugin\n * @author Erudite Intelligence LLC (Vector)\n * @created 2026-02-13\n * @purpose Define CAIP-2 identifiers, asset addresses, and network configuration for Tron\n */\n\n// =============================================================================\n// CAIP-2 Network Identifiers\n// Format: tron:<genesis_block_hash_prefix>\n// Reference: https://docs.offblocks.xyz/developer-guides/api-integration/blockchain-identifiers\n// =============================================================================\n\n/** Tron Mainnet CAIP-2 identifier */\nexport const TRON_MAINNET = \"tron:27Lqcw\" as const;\n\n/** Tron Shasta Testnet CAIP-2 identifier */\nexport const TRON_SHASTA = \"tron:4oPwXB\" as const;\n\n/** Tron Nile Testnet CAIP-2 identifier */\nexport const TRON_NILE = \"tron:6FhfKq\" as const;\n\n/** CAIP-2 family pattern for Tron networks */\nexport const TRON_CAIP_FAMILY = \"tron:*\" as const;\n\n/** All supported Tron networks for V2 registration */\nexport const TRON_NETWORKS = [TRON_MAINNET, TRON_SHASTA, TRON_NILE] as const;\n\n/** All supported Tron networks for V1 backwards compatibility */\nexport const TRON_V1_NETWORKS = [TRON_MAINNET] as const;\n\n// =============================================================================\n// RPC Endpoints\n// =============================================================================\n\n/** Default RPC endpoints per CAIP-2 network identifier */\nexport const TRON_RPC_URLS: Record<string, string> = {\n  [TRON_MAINNET]: \"https://api.trongrid.io\",\n  [TRON_SHASTA]: \"https://api.shasta.trongrid.io\",\n  [TRON_NILE]: \"https://nile.trongrid.io\",\n};\n\n// =============================================================================\n// Token Addresses (Base58)\n// =============================================================================\n\n/** USDT TRC-20 contract addresses by CAIP-2 network */\nexport const USDT_ADDRESSES: Record<string, string> = {\n  [TRON_MAINNET]: \"TR7NHqjeKQxGTCi8q8ZY4pL8otSzgjLj6t\",\n  [TRON_SHASTA]: \"TG3XXyExBkPp9nzdajDZsozEu4BkaSJozs\", // Shasta USDT\n  [TRON_NILE]: \"TXLAQ63Xg1NAzckPwKHvzw7CSEmLMEqcdj\",   // Nile USDT\n};\n\n/** USDC TRC-20 contract addresses by CAIP-2 network */\nexport const USDC_ADDRESSES: Record<string, string> = {\n  [TRON_MAINNET]: \"TEkxiTehnzSmSe2XqrBj4w32RUN966rdz8\",\n};\n\n/** USDT decimals (6) - same across all TRC-20 USDT deployments */\nexport const USDT_DECIMALS = 6;\n\n/** USDC decimals (6) */\nexport const USDC_DECIMALS = 6;\n\n// =============================================================================\n// EruditePay Wrapper Contract\n// The hands-free x402 wrapper contract deployed on Tron mainnet.\n// Collects 0.25% facilitator fee automatically on-chain.\n// =============================================================================\n\n/** EruditePay wrapper contract address on Tron mainnet */\nexport const ERUDITEPAY_WRAPPER_CONTRACT = \"THGkLBrLY1G5VovZjjK1jP9upyxRdMNL3b\";\n\n/** EruditePay facilitator fee: 0.25% (25 basis points) */\nexport const ERUDITEPAY_FEE_BPS = 25;\n\n// =============================================================================\n// TRC-20 ABI (minimal for transfer operations)\n// =============================================================================\n\n/** Minimal TRC-20 ABI for transfer and balance operations */\nexport const TRC20_ABI = [\n  {\n    constant: false,\n    inputs: [\n      { name: \"_to\", type: \"address\" },\n      { name: \"_value\", type: \"uint256\" },\n    ],\n    name: \"transfer\",\n    outputs: [{ name: \"\", type: \"bool\" }],\n    type: \"Function\",\n  },\n  {\n    constant: true,\n    inputs: [{ name: \"_owner\", type: \"address\" }],\n    name: \"balanceOf\",\n    outputs: [{ name: \"balance\", type: \"uint256\" }],\n    type: \"Function\",\n  },\n  {\n    constant: true,\n    inputs: [\n      { name: \"_owner\", type: \"address\" },\n      { name: \"_spender\", type: \"address\" },\n    ],\n    name: \"allowance\",\n    outputs: [{ name: \"remaining\", type: \"uint256\" }],\n    type: \"Function\",\n  },\n  {\n    constant: false,\n    inputs: [\n      { name: \"_spender\", type: \"address\" },\n      { name: \"_value\", type: \"uint256\" },\n    ],\n    name: \"approve\",\n    outputs: [{ name: \"\", type: \"bool\" }],\n    type: \"Function\",\n  },\n  {\n    constant: true,\n    inputs: [],\n    name: \"decimals\",\n    outputs: [{ name: \"\", type: \"uint8\" }],\n    type: \"Function\",\n  },\n] as const;\n\n// =============================================================================\n// Energy/Bandwidth Defaults\n// =============================================================================\n\n/**\n * Estimated energy cost for a TRC-20 transfer.\n * Used for pre-flight checks. Actual cost may vary.\n */\nexport const ESTIMATED_TRC20_TRANSFER_ENERGY = 65_000;\n\n/**\n * Estimated bandwidth cost for a TRC-20 transfer (in bytes).\n * Used for pre-flight checks.\n */\nexport const ESTIMATED_TRC20_TRANSFER_BANDWIDTH = 350;\n\n/**\n * Maximum acceptable energy fee for a facilitator-paid transaction (in SUN).\n * 100 TRX = 100_000_000 SUN. Prevents runaway costs.\n */\nexport const MAX_ENERGY_FEE_SUN = 100_000_000;\n","/**\n * @module @erudite-intelligence/x402-tron-v2 - Client Registration\n * @author Erudite Intelligence LLC (Vector)\n * @created 2026-02-13\n */\n\nimport { x402Client } from \"@x402/core/client\";\nimport type { Network } from \"@x402/core/types\";\nimport type { ClientTronSigner } from \"../../signer\";\nimport { ExactTronScheme } from \"./scheme\";\nimport { TRON_NETWORKS } from \"../../constants\";\n\n/**\n * Configuration options for registering Tron schemes to an x402Client\n */\nexport interface TronClientConfig {\n  signer: ClientTronSigner;\n  networks?: Network | Network[];\n}\n\n/**\n * Registers Tron exact payment schemes to an x402Client instance.\n *\n * @param client - The x402Client instance to register schemes to\n * @param config - Configuration for Tron client registration\n * @returns The client instance for chaining\n */\nexport function registerExactTronClientScheme(\n  client: x402Client,\n  config: TronClientConfig,\n): x402Client {\n  const networks = config.networks\n    ? (Array.isArray(config.networks) ? config.networks : [config.networks])\n    : ([...TRON_NETWORKS] as Network[]);\n\n  const scheme = new ExactTronScheme(config.signer);\n\n  // x402Client.register() takes a single Network per call (unlike x402Facilitator)\n  for (const network of networks) {\n    client.register(network, scheme);\n  }\n\n  return client;\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;AC6BO,IAAM,kBAAN,MAAqD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQ1D,YAA6B,QAA0B;AAA1B;AAAA,EAA2B;AAAA,EAP/C,SAAS;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAiClB,MAAM,qBACJ,aACA,qBAC+B;AAE/B,UAAM,aAAa,MAAM,KAAK,OAAO;AAAA,MACnC,oBAAoB;AAAA;AAAA,MACpB,oBAAoB;AAAA;AAAA,MACpB,oBAAoB;AAAA;AAAA,IACtB;AAGA,UAAM,WAAW,MAAM,KAAK,OAAO,gBAAgB,UAAU;AAG7D,WAAO;AAAA,MACL;AAAA,MACA,SAAS;AAAA,QACP,mBAAmB,KAAK,UAAU,QAAQ;AAAA,QAC1C,MAAM,KAAK,OAAO;AAAA,QAClB,MAAO,SAAqC;AAAA,MAC9C;AAAA,IACF;AAAA,EACF;AACF;;;ACxEO,IAAM,eAAe;AAGrB,IAAM,cAAc;AAGpB,IAAM,YAAY;AAMlB,IAAM,gBAAgB,CAAC,cAAc,aAAa,SAAS;AAU3D,IAAM,gBAAwC;AAAA,EACnD,CAAC,YAAY,GAAG;AAAA,EAChB,CAAC,WAAW,GAAG;AAAA,EACf,CAAC,SAAS,GAAG;AACf;AAOO,IAAM,iBAAyC;AAAA,EACpD,CAAC,YAAY,GAAG;AAAA,EAChB,CAAC,WAAW,GAAG;AAAA;AAAA,EACf,CAAC,SAAS,GAAG;AAAA;AACf;AAGO,IAAM,iBAAyC;AAAA,EACpD,CAAC,YAAY,GAAG;AAClB;;;AC9BO,SAAS,8BACd,QACA,QACY;AACZ,QAAM,WAAW,OAAO,WACnB,MAAM,QAAQ,OAAO,QAAQ,IAAI,OAAO,WAAW,CAAC,OAAO,QAAQ,IACnE,CAAC,GAAG,aAAa;AAEtB,QAAM,SAAS,IAAI,gBAAgB,OAAO,MAAM;AAGhD,aAAW,WAAW,UAAU;AAC9B,WAAO,SAAS,SAAS,MAAM;AAAA,EACjC;AAEA,SAAO;AACT;","names":[]}